<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.appointment.mapper.AppointmentMapper">
    
    <resultMap type="com.ruoyi.appointment.domain.Appointment" id="AppointmentResult">
        <result property="id"    column="id"    />
        <result property="patientId"    column="patient_id"    />
        <result property="scheduleId"    column="schedule_id"    />
        <result property="status"    column="status"    />
        <result property="bookedAt"    column="booked_at"    />
        <result property="appointmentTime" column="appointment_time" />
        <result property="patientName" column="patient_name" />
        <result property="doctorName" column="doctor_name" />
        <result property="workDate" column="work_date" />
        <result property="timeSlot" column="time_slot" />
        <result property="doctorId" column="doctor_id" />
        <result property="deptName" column="dept_name" />
    </resultMap>

    <sql id="selectAppointmentVo">
        select a.id, a.patient_id, a.schedule_id, a.status, a.booked_at, a.appointment_time,
               p.name as patient_name,
               d.name as doctor_name,
               s.work_date, s.time_slot, s.doctor_id,
               dept.name as dept_name
        from appointment a
        left join patient p on a.patient_id = p.id
        left join schedule s on a.schedule_id = s.id
        left join doctor d on s.doctor_id = d.id
        left join department dept on d.dept_id = dept.id
    </sql>

    <select id="selectAppointmentList" parameterType="com.ruoyi.appointment.domain.Appointment" resultMap="AppointmentResult">
        <include refid="selectAppointmentVo"/>
        <where>  
            <if test="patientId != null "> and a.patient_id = #{patientId}</if>
            <if test="scheduleId != null "> and a.schedule_id = #{scheduleId}</if>
            <if test="status != null  and status != ''"> and a.status = #{status}</if>
            <if test="doctorId != null "> and s.doctor_id = #{doctorId}</if>
            <if test="patientName != null and patientName != ''"> and p.name like concat('%', #{patientName}, '%')</if>
        </where>
    </select>
    
</mapper>
